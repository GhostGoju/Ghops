CAPAS DE LA PAGINA
htaccess toma la url y la divide
index toma el parametro inicial (cmdconsultar) y lo envia a frontcontroller
frontcontroller toma la accion que le envio index y lo redirije al documento correspondiente
El doxumento ejecuta su logica y la devuelve


---------------------------------------------------------------------
index extrae los datos, entra la logica del control. El modelo hace las consultas dentro de la base de datos retorna los datos al formControlName="control"
el control hace las respecticas operaciones y devuelve al index (SE REPITE EL CICLO).


---------------------------------------------------------------------
NOTAS GENERALES:
* Colocando un punto frente a un documento podemos volverlo incognito frente a personas que puedan vulnerar nuestro sistema
* El documento htaccess, nos permite crear una URl interna la cual esta oculta para las otras personas esto nos permite tener mas proteccion dentro de nuestro sitio web
* La función isset() en PHP se utiliza para verificar si una variable está definida y su valor no es NULL. Esta función devuelve un valor booleano: true si la variable está definida y no es NULL, y false en caso contrario


---------------------------------------------------------------------
HTACCESS DESCRIPCION DE LINEA DE CODIGO:
RewriteRule ^(.+) $index.php?url=$1 [QSA,L]
regla de reescritura / si encuentra un parametro que tenga punto o mas lo modifica / se le indica el parametro a modificar se marca como url
se asigna una varible para almacenar los datos


---------------------------------------------------------------------

HTACCESS TOMA LA EL URL Y LO DESCOMPONE - LA INFROMACION LA TOMA LA CLASE ACTIONS (ARCHIVO SETTINGS) Y CREA UNA RUTA AL ARCHIVO - EL FRONTCONTROLLER TOMA LA DIRECCION Y CREA UN
OBJETO QUE DISPARA EL METODO EJECUTAR (EXECUTE) DENTRO DE TODOS LOS ARCHIVOS CON ACCIONES - SE LLAMA AL CONTROL EL CUAL INVOCA EL MODELO Y LA ACCION QUE DESEA -
EL MODELO DISPARA LAS ACCIONES CORRESPONDIENTES Y CONSULTA LA BASE DE DATOS Y DEVOLVERA AL CONTROL - EL CONTROL ENVIA LOS DATOS AL CMD(ACCION CORRESPONDIENTE) -
EL CMD EJECUTA LA LOGICA EN SU INTERIOR E IMPRIME LA RESPUESTA


---------------------------------------------------------------------

<?php

class cmdAutenticar
{
    private $default_request_method = "POST";
    public function execute()
    {
        valid_method($this->default_request_method);
        extract($_REQUEST);
        $u = new usuariosControl();
        $result = $u->autenticar($email, $password, $rol);

        $response = [
            "result" => "fail",
            "data" => "",
            "message" => "Usuario invalido",
            "view" => "login"
        ];

        if (is_array($result)) {
            if ($result['rol'] == 1) {
                $response['message'] = "Admin valido";
                $response['view'] = "home";
            } elseif ($result['rol'] == 2) {
                $response['message'] = "Usuario valido";
                $response['view'] = "home";
            }
        } elseif ($result == 0) {
            $response['message'] = "defaultError";
        }

        return $response;
    }
}



// --------------------------------------------

session_start(); // Asegúrate de haber iniciado la sesión en tu script

if (isset($_SESSION['rol'])) {
    $rol = $_SESSION['rol'];

    switch ($rol) {
        case 'administrador':
            header('Location: /ruta-para-administradores.php');
            exit();
        case 'usuario_normal':
            header('Location: /ruta-para-usuarios.php');
            exit();
            // Agrega más casos según sea necesario para otros roles
        default:
            // Si el rol no coincide con ninguno de los casos anteriores, redirecciona a una página predeterminada o muestra un mensaje de error.
            header('Location: /pagina-de-error.php');
            exit();
    }
} else {
    // Si no se ha establecido un rol, redirecciona a una página de inicio de sesión.
    header('Location: /pagina-de-inicio-de-sesion.php');
    exit();
}

// --------------------------------------------


if (is_array($result)) {
    $response = [
        "result" => "success",
        "data" => $result,
        "message" => "Usuario válido",
    ];

    // Verifica el rol del usuario y redirige a la vista correspondiente
    if ($userRole === "admin") {
        $response["view"] = "admin_home";
    } elseif ($userRole === "user") {
        $response["view"] = "user_home";
    } else {
        // En caso de un rol desconocido, puedes redirigir a una vista predeterminada o mostrar un mensaje de error.
        $response["view"] = "error";
        $response["message"] = "Rol desconocido";
    }
} else {
    // Manejar el caso en que $result no sea un arreglo
    $response = [
        "result" => "error",
        "message" => "Usuario no válido",
        "view" => "login", // Puedes redirigir al inicio de sesión u otra vista adecuada.
    ];
}

// Luego, puedes redirigir a la vista correspondiente según el valor de $response["view"].
header("Location: " . $response["view"] . ".php");
exit();
